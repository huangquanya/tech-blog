<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx学习 | 好运来的技术博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="个人技术博客 Html、Css、JavaScript、Vue、React等">
    
    <link rel="preload" href="/tech-blog/assets/css/0.styles.81e9416f.css" as="style"><link rel="preload" href="/tech-blog/assets/js/app.872a19b1.js" as="script"><link rel="preload" href="/tech-blog/assets/js/3.76ec6b79.js" as="script"><link rel="preload" href="/tech-blog/assets/js/1.f01f3418.js" as="script"><link rel="preload" href="/tech-blog/assets/js/13.64e93f94.js" as="script"><link rel="prefetch" href="/tech-blog/assets/js/10.19276487.js"><link rel="prefetch" href="/tech-blog/assets/js/11.196eaa28.js"><link rel="prefetch" href="/tech-blog/assets/js/12.b60e21d0.js"><link rel="prefetch" href="/tech-blog/assets/js/14.8b02cb9e.js"><link rel="prefetch" href="/tech-blog/assets/js/15.5298c0d7.js"><link rel="prefetch" href="/tech-blog/assets/js/4.61118ec2.js"><link rel="prefetch" href="/tech-blog/assets/js/5.2773450d.js"><link rel="prefetch" href="/tech-blog/assets/js/6.26b6323a.js"><link rel="prefetch" href="/tech-blog/assets/js/7.429127da.js"><link rel="prefetch" href="/tech-blog/assets/js/8.50e8aa9d.js"><link rel="prefetch" href="/tech-blog/assets/js/9.c09de80a.js">
    <link rel="stylesheet" href="/tech-blog/assets/css/0.styles.81e9416f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>好运来的技术博客</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>个人技术博客 Html、Css、JavaScript、Vue、React等</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2022
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/tech-blog/" class="home-link router-link-active"><!----> <span class="site-name">好运来的技术博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/tech-blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      好运来的Javascript博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/huangquanya" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/747323640255918" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><!----> <!----> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>6</h3> <h6 data-v-39576ba9>文章</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>标签</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/tech-blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      好运来的Javascript博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/huangquanya" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/747323640255918" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/tech-blog/" class="sidebar-heading clickable router-link-active"><span>欢迎学习</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech-blog/" aria-current="page" class="sidebar-link">学前必读</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/tech-blog/handbook/css/CssStackingContext" class="sidebar-heading clickable"><span>Css学习</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech-blog/handbook/css/CssStackingContext.html" class="sidebar-link">层叠上下文</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/tech-blog/handbook/browser/cache" class="sidebar-heading clickable"><span>前端相关知识</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech-blog/handbook/browser/cache.html" class="sidebar-link">缓存相关</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/tech-blog/handbook/algorithm/fib" class="sidebar-heading clickable"><span>算法学习</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech-blog/handbook/algorithm/fib.html" class="sidebar-link">斐波那契数列</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/tech-blog/handbook/backend/nginx" class="sidebar-heading clickable open active"><span>后端相关学习</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech-blog/handbook/backend/nginx.html" aria-current="page" class="active sidebar-link">nginx知识</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/tech-blog/handbook/git/git-ssh-config" class="sidebar-heading clickable"><span>git使用相关</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech-blog/handbook/git/git-ssh-config.html" class="sidebar-link">电脑上配置github和gitlab的ssh</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Nginx学习</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2022
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title">Nginx学习</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>好运来</span></i> <i class="iconfont reco-date" data-v-f875f3fc><span data-v-f875f3fc>2022/1/1</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="nginx学习"><a href="#nginx学习" class="header-anchor">#</a> Nginx学习</h1> <h1 id="_1-简介"><a href="#_1-简介" class="header-anchor">#</a> 1. 简介</h1> <h2 id="_1-1-特点"><a href="#_1-1-特点" class="header-anchor">#</a> 1.1 特点</h2> <ol><li>高性能Web服务器和反向代理服务器</li> <li>内存占用少，并发能力强，高性能、低系统资源</li> <li>免费开源</li> <li>C语言开发</li></ol> <h3 id="_1-2-正向代理和反向代理"><a href="#_1-2-正向代理和反向代理" class="header-anchor">#</a> 1.2 正向代理和反向代理</h3> <h4 id="_1-2-1-反向代理"><a href="#_1-2-1-反向代理" class="header-anchor">#</a> 1.2.1 反向代理</h4> <p>​	以代理服务器来接受Internet上的连接请求，然后将请求转发给内部网络上的服务器，并将服务器上得到的结果返回给Internet上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器</p> <img src="\nginx知识.assets\image-20211224165129560.png" alt="image-20211224165129560" style="zoom:80%;"> <h4 id="_1-2-2-正向代理"><a href="#_1-2-2-正向代理" class="header-anchor">#</a> 1.2.2 正向代理</h4> <p>正向代理类似一个跳板机，代理访问外部资源</p> <h1 id="_2-nginx环境搭建"><a href="#_2-nginx环境搭建" class="header-anchor">#</a> 2 nginx环境搭建</h1> <h2 id="_2-1-下载"><a href="#_2-1-下载" class="header-anchor">#</a> 2.1 下载</h2> <ol><li>下载地址 http://nginx.org/en/download.html</li> <li>服务器下载命令 wget http://nginx.org/download/nginx-1.21.4.tar.gz</li> <li>放到/home/soft/ 目录下</li></ol> <h2 id="_2-2-安装"><a href="#_2-2-安装" class="header-anchor">#</a> 2.2 安装</h2> <p>linux命令:</p> <ol><li>查看当前路径：pwd</li> <li>查看当前文件下全部文件：ll</li></ol> <h3 id="_2-2-1-安装前的准备"><a href="#_2-2-1-安装前的准备" class="header-anchor">#</a> 2.2.1 安装前的准备</h3> <p>​	nginx 的安装需要确定Linux安装预置库，否则配置和编译会出问题</p> <ol><li><p>gcc编译器是否安装</p> <p>检查是否安装：yum list installed | grep gcc</p> <p>安装：yum install gcc -y</p></li> <li><p>openssl库是否安装</p> <p>检查是否安装：yum list installed | grep openssl</p> <p>安装：yum install openssl openssl-devel -y</p></li> <li><p>pcre库是否安装</p> <p>检查是否安装：yum list installed | grep pcre</p> <p>安装：yum install pcre pcre-devel -y</p></li> <li><p>zlib库是否安装</p> <p>检查是否安装：yum list installed | grep zlib</p> <p>安装：yum install zlib zlib-devel -y</p></li> <li><p>一键安装</p> <p>yum install gcc openssl openssl-devel pcre pcre-devel zlib z-lib-devel -y</p></li></ol> <h3 id="_2-2-2-正式安装"><a href="#_2-2-2-正式安装" class="header-anchor">#</a> 2.2.2 正式安装</h3> <ol><li><p>解压下载下来的nginx文件，执行：</p> <p>tar -zxvf nginx.tar.gz</p></li> <li><p>切换至解压后的nginx主目录，执行命令：</p> <p>cd nginx</p></li> <li><p>在nginx主目录nginx下执行命令：(--prfix是指定nginx安装路径)</p> <p>./config --prifix=/usr/local/nginx</p></li> <li><p>执行命令进行编译：</p> <p>make</p></li> <li><p>执行安装</p> <p>make install</p></li> <li><p>安装完成后，进到/usr/local/nginx目录下，查看内容</p> <p>ll</p></li></ol> <h2 id="_2-3-启动"><a href="#_2-3-启动" class="header-anchor">#</a> 2.3 启动</h2> <h3 id="_2-3-1-普通启动"><a href="#_2-3-1-普通启动" class="header-anchor">#</a> 2.3.1 普通启动</h3> <p>切换到nginx安装目录的sbin目录下，执行：./nginx</p> <h3 id="_2-3-2-配置文件启动"><a href="#_2-3-2-配置文件启动" class="header-anchor">#</a> 2.3.2 配置文件启动</h3> <p>​	-c 是指定配置文件，且配置文件路径必须指定绝对路径</p> <ol><li><p>方式1：</p> <p>./nginx -c /usr/local/nginx/conf/nginx.conf</p></li> <li><p>方式2：</p> <p>/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</p></li></ol> <h3 id="_2-3-3-检查是否启动"><a href="#_2-3-3-检查是否启动" class="header-anchor">#</a> 2.3.3 检查是否启动</h3> <ol><li><p>通过查看进程：</p> <p>ps -ef | grep nginx</p></li> <li><p>nginx体系结构</p> <p>nginx体系结构由master进程和worker进程组成</p> <ul><li>master进程读取配置文件，并维护worker进程，</li> <li>worker进程对请求进行时机处理</li></ul> <p>nignx启动后，安装目录下会出现_temp结尾的文件，这些是临时文件</p></li></ol> <h2 id="_2-4-关闭"><a href="#_2-4-关闭" class="header-anchor">#</a> 2.4 关闭</h2> <h3 id="_2-4-1-优雅关闭nginx"><a href="#_2-4-1-优雅关闭nginx" class="header-anchor">#</a> 2.4.1 优雅关闭nginx</h3> <p>方法1：</p> <ol><li><p>找出nginx的进程号：</p> <p>ps -ef | grep nginx</p></li> <li><p>执行命令：</p> <p>kill -QUIT 主pid</p></li></ol> <p>方法二：</p> <ol><li>​	./nginx -s quit</li></ol> <p><strong>注意</strong>：</p> <ul><li>其中pid是主进程的pid(master process),其他为子进程pid（worker process）</li> <li>这种关闭方式会处理完请求后再关闭，时间长</li></ul> <h3 id="_2-4-2-快速关闭nginx"><a href="#_2-4-2-快速关闭nginx" class="header-anchor">#</a> 2.4.2 快速关闭nginx</h3> <p>方法1：</p> <ol><li><p>找出nginx的进程号：</p> <p>ps -ef | grep nginx</p></li> <li><p>kill -TERM 主pid</p> <p><strong>注意</strong>：</p> <ul><li>其中pid是主进程的pid(master process),其他为子进程pid（worker process）</li> <li>这种关闭方式不管请求是否处理完成，直接关闭，比较暴力，快速的关闭</li></ul></li></ol> <p>方法2：</p> <ol><li>​	nginx -s stop</li></ol> <h3 id="_2-4-3-重启nginx"><a href="#_2-4-3-重启nginx" class="header-anchor">#</a> 2.4.3 重启nginx</h3> <p>nginx -s reload</p> <h3 id="_2-4-4-其他命令"><a href="#_2-4-4-其他命令" class="header-anchor">#</a> 2.4.4 其他命令</h3> <ol><li><p>测试配置文件是否存在问题(检查语法问题)</p> <p>/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf -t</p> <p>或</p> <p>nginx -t</p></li> <li><p>Linux上查看nginx版本：</p> <p>/usr/local/nginx/sbin/nginx -V</p> <p>nginx -v</p> <p>-v （小写）显示nginx的版本</p> <p>-V	(大写)	显示nginx的版本、编译器版本和配置参数</p></li> <li><p>查看帮助</p> <p>nginx -？</p> <p>nginx -h</p></li> <li><p>设置nginx使用的配置文件</p> <p>nginx -c /usr/local/nginx/conf/nginx.conf</p></li></ol> <h1 id="_3-nginx配置文件说明及nginx主要应用"><a href="#_3-nginx配置文件说明及nginx主要应用" class="header-anchor">#</a> 3 nginx配置文件说明及nginx主要应用</h1> <p><img src="%5Cnginx%E7%9F%A5%E8%AF%86.assets%5Cimage-20211228113501348.png" alt="image-20211228113501348"></p> <h2 id="_3-1-nginx的核心配置文件"><a href="#_3-1-nginx的核心配置文件" class="header-anchor">#</a> 3.1 nginx的核心配置文件</h2> <p>nginx/conf目录下，名为nginx.conf</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment"># 配置worker进程运行用户root则拥有root权限</span>
<span class="token comment"># user nobody；</span>
<span class="token comment"># 配置工作进程数，根据硬件调整，通常等于cpu数量或2倍于CPU数量</span>
<span class="token directive"><span class="token keyword">worker_processes</span> <span class="token number">2</span></span><span class="token punctuation">;</span>

<span class="token comment"># 配置全局错误日志及类型，[debug | info | notice | warn | error | crit],默认是error</span>
<span class="token directive"><span class="token keyword">error_log</span> logs/error.log</span><span class="token punctuation">;</span>
<span class="token comment">#error_log logs/error.log notice;</span>
<span class="token comment">#error_log logs/error.log info;</span>

<span class="token directive"><span class="token keyword">pid</span>	logs/nginx.pid</span><span class="token punctuation">;</span> <span class="token comment">#配置进程pid文件</span>


<span class="token comment">###====================================================================</span>

<span class="token comment">#配置工作模式和连接数</span>
<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token comment">#use epoll;#默认就是使用epoll</span>
    <span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">1024</span></span><span class="token punctuation">;</span> <span class="token comment">#配置每个worker进程连接数上限(最大值65535=2^16-1)，nginx支持的总连接数就等于worker_connections*worker_processes</span>
<span class="token punctuation">}</span>

<span class="token comment">###====================================================================</span>

<span class="token comment">#配置http服务器，利用它的反向代理功能提供负载均衡支持</span>
<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token comment">#配置nginx支持哪些多媒体类型，可以在conf/mime.types查看支持哪些多媒体类型</span>
    <span class="token directive"><span class="token keyword">include</span> mime.types</span><span class="token punctuation">;</span>
    <span class="token comment">#默认文件类型 流类型，可以理解为支持任意类型</span>
    <span class="token directive"><span class="token keyword">default_type</span> application/octet-stream</span><span class="token punctuation">;</span>
    <span class="token comment">#配置日志格式</span>
    <span class="token comment">#log_format main '$remote_addr - $remote_user [$time] &quot;$request&quot;'</span>
    <span class="token comment">#				 '$status $body_bytes_sent &quot;$http_referer&quot; '</span>
    <span class="token comment">#				 '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';</span>
    
    <span class="token comment">#配置access.log日志及存放路径，并使用上面定义的main日志格式</span>
    <span class="token comment">#access_log logs/access.log main;</span>
    
    <span class="token directive"><span class="token keyword">sendfile</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span> <span class="token comment">#开启高效文件传输模式</span>
    <span class="token comment">#tcp_nopush on; #防止网络堵塞,需先开启sendfile</span>
    
    <span class="token comment">#keepalive_timeout 0;</span>
    <span class="token directive"><span class="token keyword">keepalive_timeout</span> <span class="token number">65</span></span><span class="token punctuation">;</span> <span class="token comment">#长连接超时时间，单位秒</span>
    
    <span class="token comment">#gzip on; #开启gzip压缩输出</span>
    
    <span class="token comment">###====================================================================</span>
    
    
    <span class="token comment">#配置虚拟主机</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span> <span class="token comment">#配置监听端口</span>
        <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span> <span class="token comment">#配置服务名</span>
        <span class="token comment">#多个server 监听端口和服务名不能完全一致</span>
        
        <span class="token comment">#charset koi8-r; #配置字符集 不配置默认为UTF-8</span>
        <span class="token comment">#access_log logs/host.access.log main; #配置本虚拟主机的访问日志</span>
        
        <span class="token comment">#默认的匹配斜杠/的请求，当访问路径中有斜杠/, 会被该location匹配到并进行处理</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token comment">#root</span>
            <span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span>
            <span class="token comment">#配置首页文件的名称</span>
            <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">#error_page 404 /404.html;	#配置404页面</span>
        
        <span class="token comment"># redirect server error pages to the static page /50x.html;</span>
        <span class="token directive"><span class="token keyword">error_page</span>	<span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>	/50x.html</span><span class="token punctuation">;</span> <span class="token comment">#配置50x错误页面</span>
        
        <span class="token comment">#精确匹配</span>
        <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># 引入server配置文件</span>
    <span class="token directive"><span class="token keyword">include</span> serverConfig.conf</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre></div><h2 id="_3-2-nginx-主要应用"><a href="#_3-2-nginx-主要应用" class="header-anchor">#</a> 3.2 nginx 主要应用</h2> <ul><li>静态网站部署</li> <li>负载均衡</li> <li>静态代理</li> <li>动静分离</li> <li>虚拟主机</li></ul> <h1 id="_4-静态网站部署"><a href="#_4-静态网站部署" class="header-anchor">#</a> 4 静态网站部署</h1> <p>nginx是一个HTTP的web服务器，可以将服务器上的静态文件（如HTML、图片等）通过HTTP协议返回给浏览器客户端</p> <h2 id="_4-1-例子"><a href="#_4-1-例子" class="header-anchor">#</a> 4.1 例子</h2> <p>要访问目录下：/opt/static/ace/index.html</p> <p>访问路径：ip+端口+/ace</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /ace</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /opt/static/</span><span class="token punctuation">;</span> <span class="token comment">#以分号结尾,root代表匹配的/的位置</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_4-2-匹配规则"><a href="#_4-2-匹配规则" class="header-anchor">#</a> 4.2 匹配规则</h2> <p><strong>server中有多个location时，nginx的匹配规则</strong>：</p> <ol><li>nginx服务器首先在server块中搜索是否有标准的uri和请求字符串匹配。如果有多个标准的uri可以匹配，就匹配其中匹配度最高的一个location。</li> <li>nginx在使用location块中，正则uri和请求字符串，进行匹配。如果正则匹配成功，则结束匹配，并使用这个location处理请求；如果正则匹配失败，则使用标准的uri中，匹配度最高的location。</li></ol> <p><strong>备注</strong>：</p> <ul><li><p>如果有精确匹配，会先进行精确匹配，匹配成功，立即返回结果。</p></li> <li><p>普通匹配与顺序无关，因为按照匹配的长短来取匹配结果。</p></li> <li><p>正则匹配与顺序有关，因为是从上往下匹配的。（首先匹配，就结束解析过程）</p></li> <li><p>在location中，有一种统配的location， 所以的请求都可以匹配，如下：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token comment">#因为所有地址都以/开头，所以这条规则将匹配到所有请求</span>
    <span class="token comment">#但正则和最长字符串会优先匹配</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <p><strong>结合标识符，匹配顺序如下</strong>：</p> <p>(location=) &gt; (location完整路径) &gt; (location ^~路径) &gt; (location ~,~* 正则顺序) &gt; (location部分起始路径) &gt; (location /)</p> <p>即</p> <p>(精确匹配) &gt; (最长字符串匹配，但完全匹配) &gt; (非正则匹配) &gt; (正则匹配) &gt; (最长字符串匹配，不完全匹配) &gt; (location通配)</p> <h1 id="_5-负载均衡"><a href="#_5-负载均衡" class="header-anchor">#</a> 5 负载均衡</h1> <h2 id="_5-1-负载均衡概述"><a href="#_5-1-负载均衡概述" class="header-anchor">#</a> 5.1 负载均衡概述</h2> <p>​	负载均衡通常是指将请求“均衡”分摊到集群中多个服务器节点上执行，这里的均衡是指在一个比较大的统计范围内是基本均匀的，并不是完全均匀的。</p> <h2 id="_5-2-负载均衡实现方式"><a href="#_5-2-负载均衡实现方式" class="header-anchor">#</a> 5.2 负载均衡实现方式</h2> <h3 id="_5-2-1-硬件负载均衡"><a href="#_5-2-1-硬件负载均衡" class="header-anchor">#</a> 5.2.1 硬件负载均衡</h3> <p>如：F5，深信服，Array等</p> <p><strong>优点</strong>：有厂商专业的技术服务团队提供支持，性能稳定</p> <p><strong>缺点</strong>：费用昂贵，对于规模较小的网络应用成本太高</p> <h3 id="_5-2-2-软件负载均衡"><a href="#_5-2-2-软件负载均衡" class="header-anchor">#</a> 5.2.2 软件负载均衡</h3> <p>如：nginx，LV5，HAProxy等</p> <p><strong>优点</strong>：免费开源，成本低廉</p> <h3 id="_5-2-3-nginx负载均衡"><a href="#_5-2-3-nginx负载均衡" class="header-anchor">#</a> 5.2.3 nginx负载均衡</h3> <ol><li><p>原理</p> <p><img src="%5Cnginx%E7%9F%A5%E8%AF%86.assets%5Cimage-20211227162554022.png" alt="image-20211227162554022"></p></li> <li><p>配置</p> <ul><li>在http模块加上upstream配置(其中weight表示权重)，upstream是配置nginx与后端服务器负载均衡非常重要的一个模块，并且还能对后端服务器的健康情况进行检查，若后端服务器中的一台发生故障，则前端请求不会转发到该故障的机器</li> <li>在server模块里添加location，并配置proxy_pass,其中www.myweb.com字符串要和upstream后面的字符串相等</li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code> 	<span class="token directive"><span class="token keyword">upstream</span> www.myweb.com</span> <span class="token punctuation">{</span>
 		<span class="token directive"><span class="token keyword">server</span> 192.168.115.128:8081</span><span class="token punctuation">;</span>
    	<span class="token directive"><span class="token keyword">server</span> 192.168.115.128:8082</span><span class="token punctuation">;</span>
 	<span class="token punctuation">}</span>
 	
 	<span class="token comment">#配置虚拟主机</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span>
        
        <span class="token comment">#charset koi8-r;</span>
        <span class="token comment">#access_log logs/host.access.log main;</span>
        
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token comment">#root</span>
            <span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span>
            <span class="token comment">#配置首页文件的名称</span>
            <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token directive"><span class="token keyword">location</span> /myweb</span> <span class="token punctuation">{</span>
			<span class="token directive"><span class="token keyword">proxy_pass</span> http://www.myweb.com</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h2 id="_5-3-nginx常用的负载均衡策略"><a href="#_5-3-nginx常用的负载均衡策略" class="header-anchor">#</a> 5.3 nginx常用的负载均衡策略</h2> <h4 id="_5-3-1-轮询-默认"><a href="#_5-3-1-轮询-默认" class="header-anchor">#</a> 5.3.1 轮询（默认）</h4> <p><strong>注意</strong>：这里的轮询并不是每个请求轮流分配到不同的后端服务器，与ip hash类似，但，是按照访问url的hash结果来分配请求，使得每个url定向到同一个后端服务器，主要应用于后端服务器为缓存时的场景下。<em>如果后端服务器down掉，将自动剔除</em>。</p> <h3 id="_5-3-2-权重"><a href="#_5-3-2-权重" class="header-anchor">#</a> 5.3.2 权重</h3> <p>​	每个请求按照一定比例分发到不同的后端服务器，weight值越大，访问的比例越大，用于后端服务器性能不均的情况</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> backserver</span> <span class="token punctuation">{</span>
 	<span class="token directive"><span class="token keyword">server</span> 192.168.115.128:8081 weight=5</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.115.128:8082 weight=2</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-3-3-ip-hash"><a href="#_5-3-3-ip-hash" class="header-anchor">#</a> 5.3.3 ip_hash</h3> <p>ip_hash也叫IP绑定，每个请求按访问ip的hash值分配，这样每个访问客户端会固定访问一个后端服务器，可以解决会话Session丢失的问题</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment">#算法：hash(&quot;124.207.55.82&quot;)%2    0, 1</span>
<span class="token directive"><span class="token keyword">upstream</span> backserver</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">ip_hash</span></span><span class="token punctuation">;</span>
 	<span class="token directive"><span class="token keyword">server</span> 192.168.115.128:8081</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.115.128:8082</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-3-4-最少连接"><a href="#_5-3-4-最少连接" class="header-anchor">#</a> 5.3.4 最少连接</h3> <p>web请求会被转发到连接数最少的服务器上</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> backserver</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">least_conn</span></span><span class="token punctuation">;</span> 
 	<span class="token directive"><span class="token keyword">server</span> 192.168.115.128:8081</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.115.128:8082</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-4-负载均衡其他几个配置"><a href="#_5-4-负载均衡其他几个配置" class="header-anchor">#</a> 5.4 负载均衡其他几个配置</h3> <ol><li><p>配置</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> backserver</span> <span class="token punctuation">{</span>
 	<span class="token directive"><span class="token keyword">server</span> 192.168.115.128:8081</span><span class="token punctuation">;</span>
    <span class="token comment">#其它所有的非backup机器down的时候，才请求backup机器</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.115.128:8082 backup</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>​		一般在项目上线的时候，可以分配部署不同的服务器上，然后对nginx重新reload。</p> <p>​		reload不会影响用户的访问，或者可以给一个提示页面，系统正在升级</p></li> <li><p>配置</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> backserver</span> <span class="token punctuation">{</span>
 	<span class="token directive"><span class="token keyword">server</span> 192.168.115.128:8081</span><span class="token punctuation">;</span>
    <span class="token comment">#down表示当前的server是down状态，不参与负载均衡</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.115.128:8082 down</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre></div></li></ol> <h1 id="_6-静态代理"><a href="#_6-静态代理" class="header-anchor">#</a> 6 静态代理</h1> <p>所有静态资源的访问改为访问nginx，而不是tomcat，这种方式叫静态代理，因为nginx更擅长静态资源的处理，性能好，效率高，在实际应用中，将静态资源如图片、css、html、js等交给nginx处理，而不是后台</p> <h2 id="_6-1-nginx静态代理实现方式"><a href="#_6-1-nginx静态代理实现方式" class="header-anchor">#</a> 6.1 nginx静态代理实现方式</h2> <h3 id="_6-1-1-方式一-在nginx-conf-的location中配置静态资源的后缀"><a href="#_6-1-1-方式一-在nginx-conf-的location中配置静态资源的后缀" class="header-anchor">#</a> 6.1.1 方式一 在nginx.conf 的location中配置静态资源的后缀</h3> <p>例如：当访问静态资源，则从linux服务器/opt/static 目录下获取</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~.*\.(js|css|html|gif|jpg|png|jpeg|png|bmp|swf|loc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$</span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">root</span> /opt/static</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>说明：</p> <ul><li>~表示正则匹配，也就是说后面的内容可以是正则表达式匹配</li> <li>第一个点.表示任意字符</li> <li>*表示一个或多个字符</li></ul> <h3 id="_6-1-2-方式二-在nginx-conf-的location中配置静态资源所在目录实现"><a href="#_6-1-2-方式二-在nginx-conf-的location中配置静态资源所在目录实现" class="header-anchor">#</a> 6.1.2 方式二 在nginx.conf 的location中配置静态资源所在目录实现</h3> <p>例如：当访问静态资源，则从linux服务器/opt/static目录下获取</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~.*/(js|css|img|images)</span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">root</span> /opt/static</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>将静态资源放入/opt/static目录下，然后用户访问时由nginx返回这些静态资源</p> <h1 id="_7-虚拟主机"><a href="#_7-虚拟主机" class="header-anchor">#</a> 7 虚拟主机</h1> <ol><li>虚拟主机就，把一台物理服务器划分成多个“虚拟”的服务器，这样一台物理服务器可以当作多个服务器来使用，从而可以配置多个网站</li> <li>nginx提供虚拟主机功能，为了不需要安装多个nginx就可以运行多个域名不同的网站</li> <li>nginx下，一个server标签就是一个虚拟主机。nginx的虚拟主机就是通过nginx.conf中server节点指定的，想要设置多个虚拟主机，配置多个server节点即可</li></ol> <h2 id="_7-1-配置虚拟主机方式"><a href="#_7-1-配置虚拟主机方式" class="header-anchor">#</a> 7.1 配置虚拟主机方式</h2> <h3 id="_7-1-1-基于端口的虚拟主机"><a href="#_7-1-1-基于端口的虚拟主机" class="header-anchor">#</a> 7.1.1 基于端口的虚拟主机</h3> <p>基于端口的虚拟主机配置，使用端口来区分</p> <p>浏览器使用同一个域名+端口 或 同一个ip地址+端口访问；</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">listen</span> <span class="token number">8080</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> www.myweb.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /myweb</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://www.myweb.com</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">listen</span> <span class="token number">9090</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> www.myweb.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /p2p</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://www.p2p.com</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-1-2-基于域名的虚拟主机-常用"><a href="#_7-1-2-基于域名的虚拟主机-常用" class="header-anchor">#</a> 7.1.2 基于域名的虚拟主机（常用）</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> www.myweb.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /myweb</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://www.myweb.com</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> www.p2p.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /p2p</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://www.p2p.com</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-1-3-demo"><a href="#_7-1-3-demo" class="header-anchor">#</a> 7.1.3 demo</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> www.beijing.myweb.com</span> <span class="token punctuation">{</span>
    server 192.168.115.128:8081
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">upstream</span> www.tianjing.myweb.com</span> <span class="token punctuation">{</span>
    server 192.168.115.128:8082
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">upstream</span> www.nanjing.myweb.com</span> <span class="token punctuation">{</span>
    server 192.168.115.128:8083
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> www.beijing.myweb.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://www.beijing.myweb.com</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> www.tianjing.myweb.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://www.tianjing.myweb.com</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
	<span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> www.nanjing.myweb.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://www.nanjing.myweb.com</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="_8-解决跨域"><a href="#_8-解决跨域" class="header-anchor">#</a> 8 解决跨域</h1> <p>例子：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span>
    
    <span class="token comment">#允许跨域请求的域，*代表所有</span>
    <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Origin'</span> *</span><span class="token punctuation">;</span>
    <span class="token comment">#允许带上cookie请求</span>
    <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Credentials'</span> <span class="token string">'true'</span></span><span class="token punctuation">;</span>
    <span class="token comment">#允许请求的方法，如: GET/POST/PUT/DELETE</span>
    <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Methods'</span> *</span><span class="token punctuation">;</span>
    <span class="token comment">#允许请求的header</span>
    <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Headers'</span> *</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>
</code></pre></div><h1 id="_9-资源防盗链配置"><a href="#_9-资源防盗链配置" class="header-anchor">#</a> 9 资源防盗链配置</h1> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span>
    <span class="token comment"># 对资源站点验证</span>
    <span class="token directive"><span class="token keyword">valid_referers</span> *.imooc.com</span><span class="token punctuation">;</span>
    <span class="token comment"># 非法引入会进入下方判断</span>
    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$invalid_referer</span>)</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">return</span> <span class="token number">404</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><h1 id="_10-缓存控制"><a href="#_10-缓存控制" class="header-anchor">#</a> 10 缓存控制</h1> <ol><li>控制浏览器端缓存</li></ol> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /static</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">alias</span> /home/imooc</span><span class="token punctuation">;</span>
    <span class="token comment"># d h m s</span>
    <span class="token directive"><span class="token keyword">expires</span> <span class="token number">10s</span>
    expires @22h30m</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">expires</span> -1h</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">expires</span> epoch</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">expires</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span><span class="token comment">#即默认</span>
    <span class="token directive"><span class="token keyword">expires</span> max</span><span class="token punctuation">;</span><span class="token comment">#永不过期</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li><p>反向代理缓存</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment">#proxy_cache_path 设置缓存保存的目录</span>
<span class="token comment">#	keys_zone	设置缓存名及占用空间的大小</span>
<span class="token comment">#	max_size	设置缓存大小</span>
<span class="token comment">#	inactive	超过此时间则缓存自动清理</span>
<span class="token comment">#	use_temp_path	关闭临时目录</span>

<span class="token directive"><span class="token keyword">proxy_cache_path</span> /usr/local/nginx/upsteam_cache keys_zone=mycache:5m max_size=1g inactive=30s use_temp_path=off</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span>
    <span class="token comment">#开启并使用缓存</span>
    <span class="token directive"><span class="token keyword">proxy_cache</span> mycache</span><span class="token punctuation">;</span>
    <span class="token comment"># 针对200和304状态吗的缓存设置过期时间</span>
    <span class="token directive"><span class="token keyword">proxy_cache_valid</span>	<span class="token number">200</span> <span class="token number">304</span> <span class="token number">8h</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h1 id="_11-使用nginx配置ssl证书提供https访问"><a href="#_11-使用nginx配置ssl证书提供https访问" class="header-anchor">#</a> 11 使用nginx配置SSL证书提供HTTPS访问</h1> <ol><li>安装nginx ssl模块</li> <li>上传密钥证书和key文件</li> <li>添加ssl配置</li></ol></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/tech-blog/handbook/algorithm/fib.html" class="prev">
            斐波那契数列
          </a></span> <span class="next"><a href="/tech-blog/handbook/git/git-ssh-config.html">
            电脑上配置github和gitlab的ssh
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_1-1-特点" class="sidebar-link reco-side-_1-1-特点" data-v-cb1513f6>1.1 特点</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_1-2-正向代理和反向代理" class="sidebar-link reco-side-_1-2-正向代理和反向代理" data-v-cb1513f6>1.2 正向代理和反向代理</a></li><li class="level-2" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_2-1-下载" class="sidebar-link reco-side-_2-1-下载" data-v-cb1513f6>2.1 下载</a></li><li class="level-2" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_2-2-安装" class="sidebar-link reco-side-_2-2-安装" data-v-cb1513f6>2.2 安装</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_2-2-1-安装前的准备" class="sidebar-link reco-side-_2-2-1-安装前的准备" data-v-cb1513f6>2.2.1 安装前的准备</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_2-2-2-正式安装" class="sidebar-link reco-side-_2-2-2-正式安装" data-v-cb1513f6>2.2.2 正式安装</a></li><li class="level-2" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_2-3-启动" class="sidebar-link reco-side-_2-3-启动" data-v-cb1513f6>2.3 启动</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_2-3-1-普通启动" class="sidebar-link reco-side-_2-3-1-普通启动" data-v-cb1513f6>2.3.1 普通启动</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_2-3-2-配置文件启动" class="sidebar-link reco-side-_2-3-2-配置文件启动" data-v-cb1513f6>2.3.2 配置文件启动</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_2-3-3-检查是否启动" class="sidebar-link reco-side-_2-3-3-检查是否启动" data-v-cb1513f6>2.3.3 检查是否启动</a></li><li class="level-2" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_2-4-关闭" class="sidebar-link reco-side-_2-4-关闭" data-v-cb1513f6>2.4 关闭</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_2-4-1-优雅关闭nginx" class="sidebar-link reco-side-_2-4-1-优雅关闭nginx" data-v-cb1513f6>2.4.1 优雅关闭nginx</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_2-4-2-快速关闭nginx" class="sidebar-link reco-side-_2-4-2-快速关闭nginx" data-v-cb1513f6>2.4.2 快速关闭nginx</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_2-4-3-重启nginx" class="sidebar-link reco-side-_2-4-3-重启nginx" data-v-cb1513f6>2.4.3 重启nginx</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_2-4-4-其他命令" class="sidebar-link reco-side-_2-4-4-其他命令" data-v-cb1513f6>2.4.4 其他命令</a></li><li class="level-2" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_3-1-nginx的核心配置文件" class="sidebar-link reco-side-_3-1-nginx的核心配置文件" data-v-cb1513f6>3.1 nginx的核心配置文件</a></li><li class="level-2" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_3-2-nginx-主要应用" class="sidebar-link reco-side-_3-2-nginx-主要应用" data-v-cb1513f6>3.2 nginx 主要应用</a></li><li class="level-2" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_4-1-例子" class="sidebar-link reco-side-_4-1-例子" data-v-cb1513f6>4.1 例子</a></li><li class="level-2" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_4-2-匹配规则" class="sidebar-link reco-side-_4-2-匹配规则" data-v-cb1513f6>4.2 匹配规则</a></li><li class="level-2" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_5-1-负载均衡概述" class="sidebar-link reco-side-_5-1-负载均衡概述" data-v-cb1513f6>5.1 负载均衡概述</a></li><li class="level-2" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_5-2-负载均衡实现方式" class="sidebar-link reco-side-_5-2-负载均衡实现方式" data-v-cb1513f6>5.2 负载均衡实现方式</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_5-2-1-硬件负载均衡" class="sidebar-link reco-side-_5-2-1-硬件负载均衡" data-v-cb1513f6>5.2.1 硬件负载均衡</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_5-2-2-软件负载均衡" class="sidebar-link reco-side-_5-2-2-软件负载均衡" data-v-cb1513f6>5.2.2 软件负载均衡</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_5-2-3-nginx负载均衡" class="sidebar-link reco-side-_5-2-3-nginx负载均衡" data-v-cb1513f6>5.2.3 nginx负载均衡</a></li><li class="level-2" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_5-3-nginx常用的负载均衡策略" class="sidebar-link reco-side-_5-3-nginx常用的负载均衡策略" data-v-cb1513f6>5.3 nginx常用的负载均衡策略</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_5-3-2-权重" class="sidebar-link reco-side-_5-3-2-权重" data-v-cb1513f6>5.3.2 权重</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_5-3-3-ip-hash" class="sidebar-link reco-side-_5-3-3-ip-hash" data-v-cb1513f6>5.3.3 ip_hash</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_5-3-4-最少连接" class="sidebar-link reco-side-_5-3-4-最少连接" data-v-cb1513f6>5.3.4 最少连接</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_5-4-负载均衡其他几个配置" class="sidebar-link reco-side-_5-4-负载均衡其他几个配置" data-v-cb1513f6>5.4 负载均衡其他几个配置</a></li><li class="level-2" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_6-1-nginx静态代理实现方式" class="sidebar-link reco-side-_6-1-nginx静态代理实现方式" data-v-cb1513f6>6.1 nginx静态代理实现方式</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_6-1-1-方式一-在nginx-conf-的location中配置静态资源的后缀" class="sidebar-link reco-side-_6-1-1-方式一-在nginx-conf-的location中配置静态资源的后缀" data-v-cb1513f6>6.1.1 方式一 在nginx.conf 的location中配置静态资源的后缀</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_6-1-2-方式二-在nginx-conf-的location中配置静态资源所在目录实现" class="sidebar-link reco-side-_6-1-2-方式二-在nginx-conf-的location中配置静态资源所在目录实现" data-v-cb1513f6>6.1.2 方式二 在nginx.conf 的location中配置静态资源所在目录实现</a></li><li class="level-2" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_7-1-配置虚拟主机方式" class="sidebar-link reco-side-_7-1-配置虚拟主机方式" data-v-cb1513f6>7.1 配置虚拟主机方式</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_7-1-1-基于端口的虚拟主机" class="sidebar-link reco-side-_7-1-1-基于端口的虚拟主机" data-v-cb1513f6>7.1.1 基于端口的虚拟主机</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_7-1-2-基于域名的虚拟主机-常用" class="sidebar-link reco-side-_7-1-2-基于域名的虚拟主机-常用" data-v-cb1513f6>7.1.2 基于域名的虚拟主机（常用）</a></li><li class="level-3" data-v-cb1513f6><a href="/tech-blog/handbook/backend/nginx.html#_7-1-3-demo" class="sidebar-link reco-side-_7-1-3-demo" data-v-cb1513f6>7.1.3 demo</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/tech-blog/assets/js/app.872a19b1.js" defer></script><script src="/tech-blog/assets/js/3.76ec6b79.js" defer></script><script src="/tech-blog/assets/js/1.f01f3418.js" defer></script><script src="/tech-blog/assets/js/13.64e93f94.js" defer></script>
  </body>
</html>
